services:
  msl_website_dev:
    build:
      context: .
      dockerfile: docker/website.Dockerfile
      target: developer
    command: pnpm run dev
    ports:
      - "3000:3000"
    volumes:
      # Mount the website source
      - ./app:/repo/app
      - ./src:/repo/src
      - ./content:/repo/content
      - ./public:/repo/public
      # Mask node_modules and .next
      - /repo/node_modules
      - /repo/.next
    working_dir: /repo

  # msl_website_prod:
  #   build:
  #     context: .
  #     dockerfile: docker/website.Dockerfile
  #     target: builder
  #   command: ["/bin/sh", "-c", "mkdir -p /out && cp -r /repo/out/* /out"]
  #   volumes:
  #     - ./out:/out

#   msl_ml_research:
#     build:
#       context: .
#       dockerfile: docker/ml-research.Dockerfile
#       target: development
#     ports:
#       - "8888:8888"  # Jupyter Lab
#     volumes:
#       # Mount the research directory
#       - ../research/multi_moire_construction:/workspace/notebooks
#       # Mount data directory (create if needed)
#       - ../data:/workspace/data
#       # Persistent storage for models and results
#       - ml_models:/workspace/models
#       - ml_results:/workspace/results
#     environment:
#       - NVIDIA_VISIBLE_DEVICES=all
#       - NVIDIA_DRIVER_CAPABILITIES=compute,utility
#     deploy:
#       resources:
#         reservations:
#           devices:
#             - driver: nvidia
#               count: all
#               capabilities: [gpu]
#     working_dir: /workspace/notebooks

# volumes:
#   ml_models:
#   ml_results: