# Base Configuration for Envelope Approximation Pipeline
# ========================================================

# Run identification
run_name: "test_run"
output_dir: "runs"

# ============================================================================
# Phase 0: Candidate Search Parameters
# ============================================================================

# Lattice types to explore
lattice_types:
  - square
  - hex

# Twist angle range (degrees)
theta_range: [0.5, 3.0]
n_theta: 5

# Hole radius (normalized by lattice constant)
r_over_a_list:
  - 0.20
  - 0.30
  - 0.40

# Background dielectric constant
eps_bg_list:
  - 4.0
  - 6.0
  - 9.0

# Target band indices to analyze
target_bands:
  - 3
  - 4
  - 5

# Use simplified analytical model (fast) vs full MPB (slow, accurate)
use_simplified_model: true

# MPB settings (if using full MPB)
resolution: 32
k_interp: 19
num_bands: 10

# ============================================================================
# Scoring Parameters
# ============================================================================

# Reference values for normalization
kappa_0: 1.0      # Reference curvature
Delta_0: 0.1      # Reference spectral gap
vg_ref: 0.08      # Reference group velocity scale for Dirac penalty
symmetry_ref: 1.0 # Tolerance for symmetry residuals
parab_span_ref: 0.35
v_0: 1.0          # Legacy velocity reference (frontend helper)
eps_bg_max: 12.0  # Maximum dielectric constant

# Scoring weights (additive, no normalization enforced)
w_flat: 0.6       # Band curvature / flatness weight
w_gap: 0.9        # Spectral gap weight
w_parab: 0.3      # Parabolic validity weight
w_vg: 0.25        # Parabola span weight
w_linear: 0.5     # Group-velocity penalty weight
w_sym: 0.4        # Symmetry consistency weight

# EA validity parameters
alpha_parab: 0.3  # Validity condition: |G_m| <= alpha * k_parab
beta_parab: 1.5   # Safety margin for parabolic regime

# ============================================================================
# Phase 1: Local Bloch Parameters
# ============================================================================

# Number of top candidates to process
K_candidates: 10

# Spatial grid resolution
Nx: 32
Ny: 32

# Stacking gauge
tau: [0.0, 0.0]

# Twist center gauge (set to 'auto' to use a/L_moire)
eta: auto

# Reference frequency mode: 'mean', 'min', 'max', 'median'
ref_frequency_mode: 'mean'

# ============================================================================
# Phase 2: EA Operator Parameters
# ============================================================================

# Include group velocity term (for non-extremal k-points)
include_vg_term: false

# ============================================================================
# Phase 3: EA Solver Parameters
# ============================================================================

# Number of envelope modes to compute
ea_n_modes: 10

# ============================================================================
# Phase 4: Validation Parameters
# ============================================================================

# Number of candidates to validate with full moirÃ© simulation
K_validate: 3

# ============================================================================
# Phase 5: Meep Q-factor Parameters
# ============================================================================

# Number of candidates for full Meep simulation
K_meep: 1

# Meep simulation time
sim_time: 500

# Meep resolution
meep_resolution: 32
