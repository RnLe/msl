[package]
# Benchmark-specific configuration for the moire-lattice project

[profile.bench]
# Optimizations for benchmark builds
opt-level = 3              # Maximum optimization
lto = "thin"               # Link-time optimization (thin for faster compile)
codegen-units = 1          # Single codegen unit for better optimization
panic = "abort"            # Abort on panic (slightly faster)
debug = false              # No debug info in benchmarks
overflow-checks = false    # Disable overflow checks for performance

[benchmark]
# Criterion configuration options
# These can be overridden by command-line arguments

# Default sample size for statistical analysis
sample_size = 100

# Default measurement time per benchmark
measurement_time = 5

# Default warm-up time before measurement
warm_up_time = 3

# Noise threshold for detecting significant changes (5%)
noise_threshold = 0.05

# Confidence level for statistical tests (95%)
confidence_level = 0.95

# Output format options: "pretty", "terse", "json", "csv"
output_format = "pretty"

# Whether to save baseline by default
save_baseline = false

# Default baseline name for comparisons
baseline = "main"

[features]
# Feature flags for different benchmark scenarios

# Core benchmark features
default_benchmarks = ["benchmarks"]

# All available backends
full_benchmarks = ["benchmarks", "voronoi_spade", "ws3d_quickhull"]

# Only fallback implementations (no external deps)
minimal_benchmarks = ["benchmarks"]

# Memory-intensive benchmarks (larger datasets)
stress_benchmarks = ["benchmarks", "voronoi_spade", "ws3d_quickhull"]

# Quick benchmarks for CI/CD
ci_benchmarks = ["benchmarks"]

[benchmark_groups]
# Predefined benchmark group configurations

[benchmark_groups.core]
description = "Core Voronoi cell computation benchmarks"
groups = ["voronoi_2d_benches", "voronoi_3d_benches"]
sample_size = 100
measurement_time = 5

[benchmark_groups.scaling]
description = "Performance scaling and memory benchmarks"
groups = ["scaling_benches"]
sample_size = 50
measurement_time = 10

[benchmark_groups.operations]
description = "Polyhedron and geometric operation benchmarks"
groups = ["polyhedron_benches"]
sample_size = 200
measurement_time = 3

[benchmark_groups.quick]
description = "Fast benchmarks for development and CI"
groups = ["quick_benches"]
sample_size = 20
measurement_time = 1

[test_cases]
# Standard test cases for consistent benchmarking

[test_cases.lattice_2d]
square = { a = 1.0 }
rectangular = { a = 1.0, b = 1.5 }
hexagonal = { a = 1.0 }
oblique = { a = 1.0, b = 1.2, gamma_deg = 60.0 }
tight = { a = 0.1 }
stretched = { a = 1.0, b = 10.0 }

[test_cases.lattice_3d]
simple_cubic = { a = 1.0 }
body_centered_cubic = { a = 1.0 }
face_centered_cubic = { a = 1.0 }
tetragonal = { a = 1.0, c = 2.0 }
orthorhombic = { a = 1.0, b = 1.5, c = 2.0 }
triclinic = { a = 1.0, b = 1.2, c = 1.5, alpha_deg = 70, beta_deg = 80, gamma_deg = 75 }

[test_cases.scaling]
shell_counts_2d = [3, 5, 8, 12, 20]
shell_counts_3d = [2, 3, 4, 5, 7]
radii_2d = [2.0, 3.0, 5.0, 8.0, 12.0]
radii_3d = [2.0, 3.0, 4.0, 5.0, 6.0]
tolerances = [1e-6, 1e-8, 1e-10, 1e-12, 1e-14]
lattice_sizes = [0.1, 0.5, 1.0, 2.0, 5.0, 10.0]

[comparison]
# Configuration for backend comparisons

# Expected performance relationships
# These are hints for interpreting benchmark results
spade_vs_fallback_2d = "spade_faster_for_complex_lattices"
quickhull_vs_fallback_3d = "quickhull_more_accurate_and_often_faster"

# Memory usage expectations
memory_usage = "advanced_backends_may_use_more_memory"

# Accuracy differences
accuracy = "fallback_3d_is_approximation_only"

[ci_integration]
# Settings for continuous integration

# Quick benchmark settings for CI
quick_sample_size = 10
quick_measurement_time = 1

# Performance regression thresholds
regression_threshold = 0.15  # 15% slowdown triggers warning
critical_threshold = 0.30    # 30% slowdown triggers failure

# Baseline management for CI
auto_save_baseline = true
baseline_branch = "main"

[reporting]
# HTML report configuration

# Whether to generate detailed HTML reports
generate_html = true

# Include plots in HTML reports
include_plots = true

# Include statistical analysis
include_statistics = true

# Custom CSS for reports
custom_css = ""

# Report title
title = "Moire Lattice Voronoi Cell Performance Analysis"

[environment]
# Environment-specific configurations

# Variables to capture in benchmark reports
capture_env = [
    "CARGO_CFG_TARGET_ARCH",
    "CARGO_CFG_TARGET_OS", 
    "RUSTC_VERSION",
    "CARGO_VERSION"
]

# Hardware detection
detect_hardware = true

# CPU feature detection for SIMD optimizations
detect_cpu_features = true
